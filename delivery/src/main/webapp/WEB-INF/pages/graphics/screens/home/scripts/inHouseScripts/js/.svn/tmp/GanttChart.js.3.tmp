var GanttChart = function(){

    var currentPath;
    var parentNode;
    var newNode
    var currentRow;

    var input;

    this.createGanttChart = function(id){
        TreeGrid({Layout:{Url:"../../../graphics/screens/home/scripts/inHouseScripts/js/Def.js"},
                  Data:{Script:"myData"}},id);
    }

    Grids.OnGetMenu = function(G,row,col){
        var possibleDim=[];
        possibleDim  = GraphicDataStore.getPossibleChild(row.type);
        var menuItems = [];
        var menu = {Items:menuItems};

        if(possibleDim != ""){
            for(var i=0; i< possibleDim.length; i++){
                //This is to create possible dimensions on click of currentNode
                var item = {};
                var keyName = "Name";
                item[keyName] = possibleDim[i];
                var keyName = "Text";
                item[keyName] = "Create"+possibleDim[i];
                menuItems.push(item);
            }

            if(row.type != "root"){
                //This is to delete the currentNode
                var deleteItem = {};
                var keyName = "Name";
                deleteItem[keyName] = "Delete";
                var keyName = "Text";
                deleteItem[keyName] = "Delete";
                menuItems.push(deleteItem);
            }
            return menu;
        }
    }


    Grids.OnRowDelete = function(grid,row,type){
        DeleteDimension.deleteDim(function(){
            alert("Deleted successfully")
        });
    }

    Grids.OnContextMenu = function(G,row,col,name){
        currentRow = row;
        if(name == "Delete"){
            G.DeleteRow(row);
        }else{
             showPopUp(G,row,col,name);

        }
    }

    Grids.OnStartDrag = function(grid,row,col){
        //To suppress the dragging as per the dimension type
        if(row.type == "Chapter"||row.type == "Page"||row.type == "Assortment" ) {
            return false;
        }
        else{
            return true;
        }
    }

    Grids.OnCanDrop = function(grid,row,togrid,torow,type,copy){
        if(torow.type == "Publication" || torow.type == "Chapter"){
            return 2;
        }
        else{
            return 0;
        }
    }

    Grids.OnEndDrag = function(grid,row,togrid,torow,type,X,Y,copy){
       if(type === 2){

           var oldPathForChild = row.path;
           var newChildNode = row;
           var parentNode = torow;
           newChildNode.path = parentNode.path +","+parentNode.title;
           var newPathForChild = newChildNode.path;
           var flag=isFolder(newChildNode.type);
           var prefix;
           prefix =getUrlPrefix(row.type,"move");
           prefix = prefix+row.type;
           GanttChartPresenter.dragAndDropDimensions(prefix,row.title,oldPathForChild,flag,newPathForChild,onDropSuccess);

       }
    }

    function onDropSuccess(){
       /* if(draggedNode.data.type == "Assortment"){
            var cb = draggedNode.toDict(true, function(dict){
                //dict.title = "Copy of " + dict.title;
                delete dict.key; // Remove key, so a new one will be created
            });
            droppedSrcNode.addChild(cb);
        }
        else{
            draggedNode.move(droppedSrcNode, dragHitMode);
        }*/
    }

    function addNode(data){
        Grids[0].AddRow(currentRow,null,1);
        Grids[0].SetValue(currentRow.lastChild,"name",newNode.title,1);
        Grids[0].SetValue(currentRow.lastChild,"title",newNode.title,1);
        Grids[0].SetValue(currentRow.lastChild,"path",newNode.path,1);
        Grids[0].SetValue(currentRow.lastChild,"type",newNode.type,1);
        Grids[0].SetValue(currentRow.lastChild,"Items",newNode.Items,1);
    }

    function showPopUp(G,row,col,name){
        $( "#dialog-form" ).dialog({
            height: 300,
            width: 350,
            modal: true,
            buttons: {
            "Create an account": function() {
<<<<<<< .mine
                var bValid = true;
                var name = $( "#name" ),
                    manager = $( "#manager" ),
                    startdate = $( "#startdate" ),
                    enddate = $( "#enddate" ),
                    budgetowner = $( "#budgetowner" ),
                    budgetamount = $( "#budget"),
                    currency = $( "#currency" );
                //allFields.removeClass( "ui-state-error" );
=======
>>>>>>> .r79

<<<<<<< .mine
                /*bValid = bValid && checkLength( name, "username", 3, 16 );
                 bValid = bValid && checkLength( email, "email", 6, 80 );
                 bValid = bValid && checkLength( enddate, "enddate", 5, 16 );

                 bValid = bValid && checkRegexp( name, /^[a-z]([0-9a-z_])+$/i, "Username may consist of a-z, 0-9, underscores, begin with a letter." );
                 // From jquery.validate.js (by joern), contributed by Scott Gonzalez: http://projects.scottsplayground.com/email_address_validation/
                 bValid = bValid && checkRegexp( email, /^((([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+(\.([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+)*)|((\x22)((((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(([\x01-\x08\x0b\x0c\x0e-\x1f\x7f]|\x21|[\x23-\x5b]|[\x5d-\x7e]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(\\([\x01-\x09\x0b\x0c\x0d-\x7f]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))))*(((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(\x22)))@((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?$/i, "eg. ui@jquery.com" );
                 bValid = bValid && checkRegexp( password, /^([0-9a-zA-Z])+$/, "Password field only allow : a-z 0-9" );*/
                /*if ( bValid ) {
                    $( "#users tbody" ).append( "<tr>" +
                        "<td>" + name.val() + "</td>" +
                        "<td>" + startdate.val() + "</td>" +
                        "<td>" + enddate.val() + "</td>" +
                        "</tr>" );
                    $( this ).dialog( "close" );
                } */
                input = new Object();
                input.dimensionName=name.val();
                input.managerName=manager.val();
                input.startDate=startdate.val();
                input.endDate=enddate.val();
                input.budgetOwner = budgetowner.val();
                input.budget = budgetamount.val();
                input.currency = currency.val();
                console.log(input);
                $( this ).dialog( "close" );
=======
>>>>>>> .r79
            },
            Cancel: function() {
                $( this ).dialog( "close" );
            }
        },
        close: function() {

        },
        autoOpen :true,
        changeTitle: document.getElementById("ui-id-1").innerHTML="Create New " + name,
        changeLabel: document.getElementById("dimensionName").innerHTML=name + " Name",
        datePicker: $(function() {
                        $( '.datePicker' ).datepicker({
                            showOn: 'both',
                            buttonImage: 'calendar.gif',
                            buttonImageOnly: true,
                            //changeMonth: true,
                            changeYear: true,
                            showAnim: 'blind',
                            showButtonPanel: true
                        });
                    })
        });
       /* var enteredName=prompt("Please enter "+name+" name","");
        if(enteredName != null && enteredName !=""){
            parentNode = row;
            if(parentNode.type == "root"){
                currentPath = "-1";
            }
            else{
                currentPath = parentNode.path+","+ parentNode.title;
                if(currentPath.indexOf("-1")==0)
                    currentPath = currentPath.match(/([^,]*),(.*)/)[2];   //To remove -1 root folder
            }

            var flag = isFolder(name);
            var prefix=getUrlPrefix(name,"create");
            newNode = createNewRow(enteredName,name,currentPath);
            if(name == "Assortment"){
                GanttChartPresenter.createAssortment(prefix,name,enteredName,currentPath,flag,addNode);
            }else{
                GanttChartPresenter.createDimension(prefix,name,enteredName,currentPath,flag,addNode);
            }
        }*/
    }

    function  createNewRow(name,type,path){
        var newRowNode = {
            "id": "",
            "title": name,
            "type": type,
            "path": path,
            "Items": []
        }
        return newRowNode;
    }

    function isFolder(dim){
        var flag =true;
        if(dim == "Page" || dim == "Assortment"){
            flag = false;
        }
        return flag;
    }

    var getUrlPrefix=function(type,action){
        switch(type){
            case "Chapter":
                return  "/delivery/chapter/"+action+"/";
            case "Page":
                return  "/delivery/page/"+action+"/";
            case "Assortment":
                return  "/delivery/assortment/"+action+"/";
        }
        return "/delivery/dimension/"+action+"/";
    }


}
